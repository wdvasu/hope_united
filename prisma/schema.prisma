generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Device {
  id            String         @id @default(uuid())
  label         String
  secretHash    String
  active        Boolean        @default(true)
  createdAt     DateTime       @default(now())
  revokedAt     DateTime?
  activities    Activity[]
  registrations Registration[]
  sessions      Session[]
}

model Session {
  id        String   @id @default(uuid())
  deviceId  String
  createdAt DateTime @default(now())
  expiresAt DateTime
  device    Device   @relation(fields: [deviceId], references: [id], onDelete: Cascade)
}

model Registration {
  id                String            @id @default(uuid())
  uid               String            @unique
  fullName          String
  zipCode           String
  veteranStatus     VeteranStatus
  sexualOrientation SexualOrientation
  sexualOther       String?
  gender            Gender
  genderOther       String?
  race              Race
  raceOther         String?
  ethnicity         Ethnicity
  county            County
  countyOther       String?
  waiverAgreed      Boolean
  eSignatureName    String?
  eSignatureAt      DateTime
  deviceId          String?
  createdAt         DateTime          @default(now())
  createdIp         String?
  userAgent         String?
  birthYear         Int?
  firstName         String?
  lastInitial       String?
  eSignatureImage   String?
  activities        Activity[]
  device            Device?           @relation(fields: [deviceId], references: [id])
}

model Activity {
  id             String        @id @default(uuid())
  deviceId       String?
  category       String
  createdAt      DateTime      @default(now())
  createdIp      String?
  userAgent      String?
  registrationId String?
  device         Device?       @relation(fields: [deviceId], references: [id])
  registration   Registration? @relation(fields: [registrationId], references: [id])

  @@index([createdAt])
  @@index([registrationId, createdAt])
}

model ActivityAdjustment {
  id        String   @id @default(uuid())
  day       DateTime
  category  String
  value     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([day, category])
}

enum VeteranStatus {
  YES
  NO
  REFUSED
}

enum SexualOrientation {
  HETEROSEXUAL
  GAY_LESBIAN
  BISEXUAL
  OTHER
  REFUSED
}

enum Gender {
  FEMALE
  MALE
  TRANSGENDER
  NON_BINARY
  OTHER
  REFUSED
}

enum Race {
  WHITE
  BLACK_AFRICAN_AMERICAN
  ASIAN
  AMERICAN_INDIAN_ALASKA_NATIVE
  NATIVE_HAWAIIAN_PACIFIC_ISLANDER
  OTHER
  REFUSED
}

enum Ethnicity {
  HISPANIC_LATINO
  NOT_HISPANIC_LATINO
  REFUSED
}

enum County {
  SUMMIT
  STARK
  PORTAGE
  CUYAHOGA
  OTHER_OH_COUNTY
  OUT_OF_STATE
  REFUSED
}
